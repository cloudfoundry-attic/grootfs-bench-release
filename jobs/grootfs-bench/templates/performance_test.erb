#!/bin/bash

JOB_DIR=$(dirname $0)
STORE_DIR=/var/vcap/data/grootfs/store
source ${JOB_DIR}/../env

echo "Warming up cache..."
grootfs --store $STORE_DIR create <%= p("grootfs-bench.image_name") %> my-warm-box &> /dev/null

echo "Running benchmark..."
grootfs-bench-reporter \
  --mode runner \
  --benchBinPath /var/vcap/packages/grootfs-bench/bin/grootfs-bench \
  [--store $STORE_DIR \
  --concurrency <%= p("grootfs-bench.concurrency") %> \
  --images <%= p("grootfs-bench.images") %> \
  --base-image <%= p("grootfs-bench.base_image_name") %> \
  --json \
  --nospin \
  --with-quota ]
